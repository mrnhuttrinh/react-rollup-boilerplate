"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),n=require("react-toastify");require("react-toastify/dist/ReactToastify.css");var t=require("axios"),o=require("query-string");function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var i,u=r(e),a=r(t),s=r(o),c=u.default.createContext({}),l=function(){return l=Object.assign||function(e){for(var n,t=1,o=arguments.length;t<o;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e},l.apply(this,arguments)};function f(e,n,t,o){return new(t||(t=Promise))((function(r,i){function u(e){try{s(o.next(e))}catch(e){i(e)}}function a(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(u,a)}s((o=o.apply(e,n||[])).next())}))}function d(e,n){var t,o,r,i,u={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;u;)try{if(t=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,o=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(r=u.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){u=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){u.label=i[1];break}if(6===i[0]&&u.label<r[1]){u.label=r[1],r=i;break}if(r&&u.label<r[2]){u.label=r[2],u.ops.push(i);break}r[2]&&u.ops.pop(),u.trys.pop();continue}i=n.call(e,u)}catch(e){i=[6,e],o=0}finally{t=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}function g(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var o,r,i=t.call(e),u=[];try{for(;(void 0===n||n-- >0)&&!(o=i.next()).done;)u.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(r)throw r.error}}return u}function p(e,n,t){if(t||2===arguments.length)for(var o,r=0,i=n.length;r<i;r++)!o&&r in n||(o||(o=Array.prototype.slice.call(n,0,r)),o[r]=n[r]);return e.concat(o||Array.prototype.slice.call(n))}!function(e){e.clientId="rove-client-id",e.email="log-email",e.userId="log-user-id",e.sessionId="rove-session"}(i||(i={}));var h,v,m,y;!function(e){e.frontend="rove-wallet"}(h||(h={})),function(e){e.production="prod",e.staging="stag",e.develop="dev"}(v||(v={})),function(e){e.error="error",e.warning="warning",e.critical="critical",e.info="info",e.debug="debug"}(m||(m={})),function(e){e.info="rove-frontend-info",e.debug="rove-frontend-debug",e.error="rove-frontend-error"}(y||(y={}));var b=function(){function e(){var e=this;this.handleTempQueue=function(){e._queueBeforeInit.length&&(e.userData&&e._queueBeforeInit.forEach((function(n){e.queue.push(l(l({},n),{user:Object(e.userData)}))})),e._queueBeforeInit=[])},this.init=function(){return f(e,void 0,void 0,(function(){var e=this;return d(this,(function(n){return this.userData={clientId:this.initClientId(),sessionId:this.initSessionId(),email:this.logEmail()},setInterval((function(){e.handleQueue()}),1e4),window.addEventListener("beforeunload",this.handleBeforeUnload),[2]}))}))},this.handleBeforeUnload=function(){e.handleQueue()},this.info=function(n,t){e.pushToQueue(m.info,n,t,!1)},this.debug=function(n,t){e.pushToQueue(m.debug,n,t,!1)},this.error=function(n,t){e.pushToQueue(m.error,n,t,!1)},this.log=function(n,t){e.pushToQueue(m.debug,n,t,!1)},this.handleQueue=function(){return f(e,void 0,void 0,(function(){var e=this;return d(this,(function(n){switch(n.label){case 0:if(this.userData={clientId:this.initClientId(),sessionId:this.initSessionId(),email:this.logEmail()},this.handleTempQueue(),!this.queue.length)return[3,4];this.processingLogs=p([],g(this.queue),!1),n.label=1;case 1:return n.trys.push([1,,3,4]),[4,a.default.post("https://rove-log.moshwithme.io/api/v1/logger/batch-send",{logEntries:this.processingLogs.map((function(e){return{user:e.user,env:e.env,eventName:e.eventName,data:l(l({},e.data),{platform:"webapp"}),clientTime:new Date(e.clientTime).toISOString(),service:e.service,severity:e.severity,href:window.location.href,tracking:e.tracking}}))})];case 2:return n.sent(),this.queue=this.queue.filter((function(n){return!e.processingLogs.find((function(e){return e.id===n.id}))})),[3,4];case 3:return this.processingLogs=[],[7];case 4:return[2]}}))}))},this.getQueryStringData=function(){return s.default.parse(window.location.search)},this.pushToQueue=function(n,t,o,r){var i;void 0===r&&(r=!0);var u=o||{},a=e.getQueryStringData();(null===(i=e.userData)||void 0===i?void 0:i.sessionId)?e.queue.push({id:"log-".concat(+new Date),user:e.userData,env:e.getLogEnvFromConfig(),service:h.frontend,clientTime:+new Date,severity:n,eventName:t,tracking:r,data:l(l({platform:"webapp",pageUrl:window.location.href,email:e.userData.email},u),a)}):e._queueBeforeInit.push({id:"log-".concat(+new Date),env:e.getLogEnvFromConfig(),service:h.frontend,clientTime:+new Date,severity:n,eventName:t,tracking:r,data:l(l({platform:"webapp",pageUrl:window.location.href},u),a)})},this.getLogEnvFromConfig=function(){switch(e.mode){case"production":return v.production;case"staging":return v.staging;default:return v.develop}},this.logEmail=function(){return localStorage.getItem(i.email)},this.initClientId=function(){return localStorage.getItem(i.clientId)},this.initSessionId=function(){return localStorage.getItem(i.sessionId)},this._queueBeforeInit=[],this.queue=[],this.processingLogs=[]}return Object.defineProperty(e,"instance",{get:function(){return e.inst||(e.inst=new e),e.inst},enumerable:!1,configurable:!0}),e}(),w=function(){function e(){}var n;return n=e,e.mode="develop",e.setLogging=function(){b.instance.mode=e.mode,b.instance.init()},e.setDefaultFunction=function(){e.info=console.info,e.error=console.error,e.debug=console.debug,e.warn=console.warn,e.assert=console.assert,e.clear=console.clear,e.count=console.count,e.countReset=console.countReset,e.dir=console.dir,e.dirxml=console.dirxml,e.group=console.group,e.groupCollapsed=console.groupCollapsed,e.log=console.log,e.profile=console.profile,e.profileEnd=console.profileEnd,e.trace=console.trace},e.info=function(){n.mode},e.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];"production"===n.mode&&(b.instance.error(y.error,{name:"string"==typeof e[0]?e[0]:"ERROR",error:l({},e)}),console.error.apply(console,p([],g(e),!1)))},e.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];"production"===n.mode&&(b.instance.debug(y.debug,{name:"string"==typeof e[0]?e[0]:"DEBUG",debug:l({},e)}),console.debug.apply(console,p([],g(e),!1)))},e.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];"production"===n.mode&&console.warn.apply(console,p([],g(e),!1))},e.assert=function(){n.mode},e.clear=function(){n.mode},e.count=function(){n.mode},e.countReset=function(){n.mode},e.dir=function(){n.mode},e.dirxml=function(){n.mode},e.group=function(){n.mode},e.groupCollapsed=function(){n.mode},e.groupEnd=function(){n.mode},e.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];"production"===n.mode&&(b.instance.debug(y.debug,{name:"string"==typeof e[0]?e[0]:"LOG",debug:l({},e)}),console.log.apply(console,p([],g(e),!1)))},e.profile=function(){n.mode},e.profileEnd=function(){n.mode},e.trace=function(){n.mode},e}();exports.MarketplaceProvider=function(e){var t=e.children,o=e.mode;u.default.useEffect((function(){w.mode=o||"develop","production"===w.mode?w.setLogging():w.setDefaultFunction()}),[o]);var r=u.default.useMemo((function(){return{}}),[]);return u.default.createElement(c.Provider,{value:r},t,u.default.createElement(n.ToastContainer,null))},exports.useMarketPlaceAdapter=function(){return u.default.useContext(c)};
