import e from"react";import{ToastContainer as n}from"react-toastify";import"react-toastify/dist/ReactToastify.css";import t from"axios";import o from"query-string";var r,i=e.createContext({}),u=function(){return e.useContext(i)},a=function(){return a=Object.assign||function(e){for(var n,t=1,o=arguments.length;t<o;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e},a.apply(this,arguments)};function c(e,n,t,o){return new(t||(t=Promise))((function(r,i){function u(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(u,a)}c((o=o.apply(e,n||[])).next())}))}function s(e,n){var t,o,r,i,u={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;u;)try{if(t=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,o=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(r=u.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){u=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){u.label=i[1];break}if(6===i[0]&&u.label<r[1]){u.label=r[1],r=i;break}if(r&&u.label<r[2]){u.label=r[2],u.ops.push(i);break}r[2]&&u.ops.pop(),u.trys.pop();continue}i=n.call(e,u)}catch(e){i=[6,e],o=0}finally{t=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}function l(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var o,r,i=t.call(e),u=[];try{for(;(void 0===n||n-- >0)&&!(o=i.next()).done;)u.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(r)throw r.error}}return u}function f(e,n,t){if(t||2===arguments.length)for(var o,r=0,i=n.length;r<i;r++)!o&&r in n||(o||(o=Array.prototype.slice.call(n,0,r)),o[r]=n[r]);return e.concat(o||Array.prototype.slice.call(n))}!function(e){e.clientId="rove-client-id",e.email="log-email",e.userId="log-user-id",e.sessionId="rove-session"}(r||(r={}));var d,g,p,h;!function(e){e.frontend="rove-wallet"}(d||(d={})),function(e){e.production="prod",e.staging="stag",e.develop="dev"}(g||(g={})),function(e){e.error="error",e.warning="warning",e.critical="critical",e.info="info",e.debug="debug"}(p||(p={})),function(e){e.info="rove-frontend-info",e.debug="rove-frontend-debug",e.error="rove-frontend-error"}(h||(h={}));var m=function(){function e(){var e=this;this.handleTempQueue=function(){e._queueBeforeInit.length&&(e.userData&&e._queueBeforeInit.forEach((function(n){e.queue.push(a(a({},n),{user:Object(e.userData)}))})),e._queueBeforeInit=[])},this.init=function(){return c(e,void 0,void 0,(function(){var e=this;return s(this,(function(n){return this.userData={clientId:this.initClientId(),sessionId:this.initSessionId(),email:this.logEmail()},setInterval((function(){e.handleQueue()}),1e4),window.addEventListener("beforeunload",this.handleBeforeUnload),[2]}))}))},this.handleBeforeUnload=function(){e.handleQueue()},this.info=function(n,t){e.pushToQueue(p.info,n,t,!1)},this.debug=function(n,t){e.pushToQueue(p.debug,n,t,!1)},this.error=function(n,t){e.pushToQueue(p.error,n,t,!1)},this.log=function(n,t){e.pushToQueue(p.debug,n,t,!1)},this.handleQueue=function(){return c(e,void 0,void 0,(function(){var e=this;return s(this,(function(n){switch(n.label){case 0:if(this.userData={clientId:this.initClientId(),sessionId:this.initSessionId(),email:this.logEmail()},this.handleTempQueue(),!this.queue.length)return[3,4];this.processingLogs=f([],l(this.queue),!1),n.label=1;case 1:return n.trys.push([1,,3,4]),[4,t.post("https://rove-log.moshwithme.io/api/v1/logger/batch-send",{logEntries:this.processingLogs.map((function(e){return{user:e.user,env:e.env,eventName:e.eventName,data:a(a({},e.data),{platform:"webapp"}),clientTime:new Date(e.clientTime).toISOString(),service:e.service,severity:e.severity,href:window.location.href,tracking:e.tracking}}))})];case 2:return n.sent(),this.queue=this.queue.filter((function(n){return!e.processingLogs.find((function(e){return e.id===n.id}))})),[3,4];case 3:return this.processingLogs=[],[7];case 4:return[2]}}))}))},this.getQueryStringData=function(){return o.parse(window.location.search)},this.pushToQueue=function(n,t,o,r){var i;void 0===r&&(r=!0);var u=o||{},c=e.getQueryStringData();(null===(i=e.userData)||void 0===i?void 0:i.sessionId)?e.queue.push({id:"log-".concat(+new Date),user:e.userData,env:e.getLogEnvFromConfig(),service:d.frontend,clientTime:+new Date,severity:n,eventName:t,tracking:r,data:a(a({platform:"webapp",pageUrl:window.location.href,email:e.userData.email},u),c)}):e._queueBeforeInit.push({id:"log-".concat(+new Date),env:e.getLogEnvFromConfig(),service:d.frontend,clientTime:+new Date,severity:n,eventName:t,tracking:r,data:a(a({platform:"webapp",pageUrl:window.location.href},u),c)})},this.getLogEnvFromConfig=function(){switch(e.mode){case"production":return g.production;case"staging":return g.staging;default:return g.develop}},this.logEmail=function(){return localStorage.getItem(r.email)},this.initClientId=function(){return localStorage.getItem(r.clientId)},this.initSessionId=function(){return localStorage.getItem(r.sessionId)},this._queueBeforeInit=[],this.queue=[],this.processingLogs=[]}return Object.defineProperty(e,"instance",{get:function(){return e.inst||(e.inst=new e),e.inst},enumerable:!1,configurable:!0}),e}(),v=function(){function e(){}var n;return n=e,e.mode="develop",e.setLogging=function(){m.instance.mode=e.mode,m.instance.init()},e.setDefaultFunction=function(){e.info=console.info,e.error=console.error,e.debug=console.debug,e.warn=console.warn,e.assert=console.assert,e.clear=console.clear,e.count=console.count,e.countReset=console.countReset,e.dir=console.dir,e.dirxml=console.dirxml,e.group=console.group,e.groupCollapsed=console.groupCollapsed,e.log=console.log,e.profile=console.profile,e.profileEnd=console.profileEnd,e.trace=console.trace},e.info=function(){n.mode},e.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];"production"===n.mode&&(m.instance.error(h.error,{name:"string"==typeof e[0]?e[0]:"ERROR",error:a({},e)}),console.error.apply(console,f([],l(e),!1)))},e.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];"production"===n.mode&&(m.instance.debug(h.debug,{name:"string"==typeof e[0]?e[0]:"DEBUG",debug:a({},e)}),console.debug.apply(console,f([],l(e),!1)))},e.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];"production"===n.mode&&console.warn.apply(console,f([],l(e),!1))},e.assert=function(){n.mode},e.clear=function(){n.mode},e.count=function(){n.mode},e.countReset=function(){n.mode},e.dir=function(){n.mode},e.dirxml=function(){n.mode},e.group=function(){n.mode},e.groupCollapsed=function(){n.mode},e.groupEnd=function(){n.mode},e.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];"production"===n.mode&&(m.instance.debug(h.debug,{name:"string"==typeof e[0]?e[0]:"LOG",debug:a({},e)}),console.log.apply(console,f([],l(e),!1)))},e.profile=function(){n.mode},e.profileEnd=function(){n.mode},e.trace=function(){n.mode},e}(),y=function(t){var o=t.children,r=t.mode;e.useEffect((function(){v.mode=r||"develop","production"===v.mode?v.setLogging():v.setDefaultFunction()}),[r]);var u=e.useMemo((function(){return{}}),[]);return e.createElement(i.Provider,{value:u},o,e.createElement(n,null))};export{y as MarketplaceProvider,u as useMarketPlaceAdapter};
